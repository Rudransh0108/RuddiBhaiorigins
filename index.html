<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jarvis â€” Web Voice Assistant (Ultimate)</title>
<link rel="manifest" href="manifest_v2.json">
<script>
Â  if ("serviceWorker" in navigator) {
Â Â Â  navigator.serviceWorker.register("sw.js").catch(e => console.warn('SW register failed', e));
Â  }
</script>
<style>
/* ==========================
Â Â  THEME (Jarvis) - orange/green
Â Â  ========================== */
:root{
Â  --bg:#081018;
Â  --card:#09121a;
Â  --muted:#9aa6b3;
Â  --accent:#ff6a00; /* orange warm accent */
Â  --accent2:#22c55e; /* green secondary */
Â  --glass: rgba(255,255,255,0.03);
Â  --success: #22c55e;
Â  --danger: #ff6a00;
}
html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#041018 0%, #081018 100%); color:#e6eef8}
.wrap{max-width:1100px; margin:18px auto; padding:18px;}
header{display:flex;align-items:center;gap:16px}
h1{font-size:20px;margin:0}
.subtitle{color:var(--muted); font-size:13px}
.controls{display:flex;gap:8px; margin-top:14px; flex-wrap:wrap}
button{background:var(--card); color:inherit;border:1px solid rgba(255,255,255,0.03); padding:10px 12px; border-radius:8px; cursor:pointer}
button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#022; font-weight:700}
.panel{margin-top:18px; display:grid; grid-template-columns: 1fr 420px; gap:16px}
.card{background:var(--glass); border-radius:10px; padding:14px; box-shadow:0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
#left {min-height:520px}
#right {min-height:520px}
#transcript{min-height:160px; background: rgba(255,255,255,0.02); padding:10px; border-radius:8px; color:#dff0d8; overflow:auto}
#log{height:260px; overflow:auto; font-size:13px; color:var(--muted); background: rgba(255,255,255,0.01); padding:8px; border-radius:6px}
.row{display:flex; gap:8px; align-items:center}
label{font-size:13px;color:var(--muted)}
input[type="text"], input[type="search"], textarea{flex:1; padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit}
.hint{font-size:12px;color:var(--muted); margin-top:8px}
.smallbtn{padding:6px 8px; font-size:13px}
.status{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03); color:var(--muted); font-size:13px}
.command-list{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-top:10px}
.cmd{background:rgba(255,255,255,0.02); padding:8px;border-radius:6px;font-size:13px;color:var(--muted); cursor:pointer}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
.kbd{background:#071827;padding:4px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04); font-weight:700}
.muted{color:var(--muted)}
.utility-dock{max-width:1100px; margin: 12px auto 22px; padding:12px; display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:10px;}
.util{ background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); color:#e6eef8; padding:12px; border-radius:12px; text-align:center; font-size:14px; cursor:pointer }
.util small{ display:block; color:#94a3b8; font-size:12px; margin-top:4px }
.overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; color: #fff; font-family: inherit; }
#powerOverlay { background: rgba(0,0,0,0.98); flex-direction: column; gap:18px; }
#powerSpinner { width:64px;height:64px;border-radius:50%; border:6px solid rgba(255,255,255,0.12); border-top-color:#fff; animation: spin 1s linear infinite}
@keyframes spin { to{ transform: rotate(360deg);} }
#cameraOverlay { background: rgba(0,0,0,0.94); color:#fff; flex-direction: column; gap:10px; }
#cameraView { width:min(92vw,960px); height: min(70vh,520px); background:#000; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,0.06) }
#cameraView video{ width:100%; height:100%; object-fit:cover }
.overlayTopBar{ position: fixed; top:14px; left:50%; transform: translateX(-50%); display:flex; gap:8px; align-items:center; background:rgba(255,255,255,0.04); padding:8px 12px; border:1px solid rgba(255,255,255,0.06); border-radius:999px; z-index:10000; color:#fff }
.overlayTopBar button{ background:transparent; border:1px solid rgba(255,255,255,0.12); color:#fff; padding:8px 10px; border-radius:999px; cursor:pointer }
#lockOverlay{ background: rgba(0,0,0,0.9); color:#fff; flex-direction:column; gap:12px; text-align:center }
#flashlightOverlay{ background:#ffffff; display:none } /* white screen to simulate torch */
.badge-line{ text-align:center; color:#94a3b8; font-size:12px; margin-bottom:18px }
#boomCanvas { position: fixed; inset:0; pointer-events:none; z-index:11000; display:none }
.hidden{ display:none !important; }
select.verysmall{ padding:6px; border-radius:6px; background:var(--card); color:inherit; border:1px solid rgba(255,255,255,0.03) }
.voice-meter { width:100%; height:36px; background:rgba(255,255,255,0.02); border-radius:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.03) }
.voice-meter > div { height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width 120ms linear; }
.mem-list { max-height:180px; overflow:auto; padding:6px; background: rgba(255,255,255,0.01); border-radius:8px; margin-top:8px; }
@media (max-width:980px){ .panel{grid-template-columns:1fr} #right{order:2} }
</style>
</head>
<body>
Â  <div class="wrap">
Â Â Â  <header>
Â Â Â Â Â  <div>
Â Â Â Â Â Â Â  <h1>Jarvis â€” Web Voice Assistant</h1>
Â Â Â Â Â Â Â  <div class="subtitle">Speak commands or type them. Works in Chrome/Edge. No server required.</div>
Â Â Â Â Â  </div>
Â Â Â Â Â  <div style="margin-left:auto;text-align:right">
Â Â Â Â Â Â Â  <div class="status" id="listenStatus">Idle</div>
Â Â Â Â Â Â Â  <div style="height:6px"></div>
Â Â Â Â Â Â Â  <div class="muted" style="font-size:12px">Language: <span id="langLabel">English (en-US)</span></div>
Â Â Â Â Â  </div>
Â Â Â  </header> 

Â Â Â  <div class="controls">
Â Â Â Â Â  <button id="btnStart" class="primary">Start Listening</button>
Â Â Â Â Â  <button id="btnStop">Stop</button>
Â Â Â Â Â  <button id="btnWake">Wake-word: <span id="wakeState">Off</span></button>
Â Â Â Â Â  <label style="margin-left:6px;color:var(--muted)">Custom wake:</label>
Â Â Â Â Â  <input id="wakeInput" type="text" placeholder="e.g. Oye Jarvis" style="width:160px"/>
Â Â Â Â Â  <button id="btnSaveWake" class="smallbtn">Save</button>
Â Â Â Â Â  <button id="btnToggleVoice">Toggle Voice Reply</button>
Â Â Â Â Â  <button id="btnClearLog" class="smallbtn">Clear Log</button>
Â Â Â Â Â  <select id="langSelect" class="verysmall">
Â Â Â Â Â Â Â  <option value="en-US">English (en-US)</option>
Â Â Â Â Â Â Â  <option value="hi-IN">Hindi (hi-IN)</option>
Â Â Â Â Â  </select>
Â Â Â Â Â  <label style="margin-left:8px;color:var(--muted)">Voice:</label>
Â Â Â Â Â  <select id="voiceSelect" class="verysmall"></select>
Â Â Â Â Â  <button id="btnSaveMemory" title="Save memory (e.g. remember my birthday)">ğŸ’¾ Save Memory</button>
Â Â Â Â Â  <button id="btnShowMemory" title="Show saved memories">ğŸ—‚ï¸ Memories</button>
Â Â Â  </div> 

Â Â Â  <div class="panel">
Â Â Â Â Â  <div id="left" class="card">
Â Â Â Â Â Â Â  <h3>Say or type a command</h3>
Â Â Â Â Â Â Â  <div id="transcript">Press <span class="kbd">Start Listening</span> and speak â€” or type below.</div> 

Â Â Â Â Â Â Â  <div style="margin-top:12px" class="row">
Â Â Â Â Â Â Â Â Â  <input id="cmdInput" type="text" placeholder="e.g. open youtube / what is the time / search cats" />
Â Â Â Â Â Â Â Â Â  <button id="btnSend" class="smallbtn">Send</button>
Â Â Â Â Â Â Â  </div> 

Â Â Â Â Â Â Â  <div class="hint">Tip: Say <b>"Hey Jarvis"</b> (or your custom wake) to activate when wake-word is ON. Try: <em>open youtube, search weather Chennai, time, wiki Tesla, calculate 12*8, set timer 10 seconds</em></div> 

Â Â Â Â Â Â Â  <div style="margin-top:12px">
Â Â Â Â Â Â Â Â Â  <strong>Quick commands</strong>
Â Â Â Â Â Â Â Â Â  <div class="command-list">
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="open youtube">open youtube</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="open google">open google</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="search cats">search cats</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="time">time</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="date">date</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="wiki tesla">wiki tesla</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="calculate 12 + 34">calculate 12 + 34</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="set timer 15 seconds">set timer 15 seconds</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="play music">play music</div>
Â Â Â Â Â Â Â Â Â Â Â  <div class="cmd" data-cmd="tell me a joke">tell me a joke</div>
Â Â Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  </div> 

Â Â Â Â Â Â Â  <hr style="border-color: rgba(255,255,255,0.04); margin:14px 0"> 

Â Â Â Â Â Â Â  <h4>Extra features (voice shortcuts)</h4>
Â Â Â Â Â Â Â  <div class="row" style="gap:10px;flex-wrap:wrap;margin-top:10px">
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnWeather">Weather</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnNews">Top News</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnQuote">Motivate Me</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnSpotify">Play on Spotify</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnTranslate">Translate</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnScreenshot">Screenshot</button>
Â Â Â Â Â Â Â Â Â  <button class="smallbtn" id="btnSelfDestruct">Self-Destruct!</button>
Â Â Â Â Â Â Â  </div> 

Â Â Â Â Â Â Â  <hr style="border-color: rgba(255,255,255,0.04); margin:14px 0"> 

Â Â Â Â Â Â Â  <div style="margin-top:8px">
Â Â Â Â Â Â Â Â Â  <strong>Games</strong>
Â Â Â Â Â Â Â Â Â  <div class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap">
Â Â Â Â Â Â Â Â Â Â Â  <button id="btnRPS" class="smallbtn">Rock Paper Scissors</button>
Â Â Â Â Â Â Â Â Â Â Â  <button id="btnGuess" class="smallbtn">Guess Number</button>
Â Â Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  </div> 

Â Â Â Â Â Â Â  <hr style="border-color: rgba(255,255,255,0.04); margin:14px 0"> 

Â Â Â Â Â Â Â  <h4>Voice / Mood meter</h4>
Â Â Â Â Â Â Â  <div class="voice-meter" id="voiceMeter"><div></div></div>
Â Â Â Â Â Â Â  <div class="hint">Jarvis listens to loudness to infer mood (basic heuristic).</div> 

Â Â Â Â Â Â Â  <hr style="border-color: rgba(255,255,255,0.04); margin:14px 0"> 

Â Â Â Â Â Â Â  <h4>Face-login (optional)</h4>
Â Â Â Â Â Â Â  <div class="row" style="gap:8px; align-items:center">
Â Â Â Â Â Â Â Â Â  <button id="btnFaceCapture" class="smallbtn">Capture Face (Enroll)</button>
Â Â Â Â Â Â Â Â Â  <button id="btnFaceLogin" class="smallbtn">Login with Face</button>
Â Â Â Â Â Â Â Â Â  <div id="faceStatus" class="muted" style="margin-left:8px">No face enrolled</div>
Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  <div id="facePreview" style="margin-top:8px"></div> 

Â Â Â Â Â  </div> 

Â Â Â Â Â  <div id="right" class="card">
Â Â Â Â Â Â Â  <h3>Activity Log</h3>
Â Â Â Â Â Â Â  <div id="log"></div> 

Â Â Â Â Â Â Â  <h4 style="margin-top:12px">Settings</h4>
Â Â Â Â Â Â Â  <div class="row" style="margin-top:6px">
Â Â Â Â Â Â Â Â Â  <label>Voice reply:</label>
Â Â Â Â Â Â Â Â Â  <input type="checkbox" id="chkVoice" checked />
Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  <div class="row" style="margin-top:6px">
Â Â Â Â Â Â Â Â Â  <label>Continuous listen:</label>
Â Â Â Â Â Â Â Â Â  <input type="checkbox" id="chkContinuous" />
Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  <div class="row" style="margin-top:6px">
Â Â Â Â Â Â Â Â Â  <label>Wake-word required:</label>
Â Â Â Â Â Â Â Â Â  <input type="checkbox" id="chkWakeReq" />
Â Â Â Â Â Â Â  </div> 

Â Â Â Â Â Â Â  <h4 style="margin-top:12px">Memories</h4>
Â Â Â Â Â Â Â  <div style="display:flex; gap:8px; margin-top:6px;">
Â Â Â Â Â Â Â Â Â  <input id="memInput" placeholder="Note to remember" />
Â Â Â Â Â Â Â Â Â  <button id="memAdd" class="smallbtn">Add</button>
Â Â Â Â Â Â Â  </div>
Â Â Â Â Â Â Â  <div class="mem-list" id="memList"></div> 

Â Â Â Â Â Â Â  <div style="margin-top:10px" class="muted">Supported in Chrome/Edge. Safari support is limited.</div>
Â Â Â Â Â  </div>
Â Â Â  </div> 

Â Â Â  <div class="utility-dock">
Â Â Â Â Â  <div class="util" data-cmd="power off phone">Power Off<small>voice: power off phone</small></div>
Â Â Â Â Â  <div class="util" data-cmd="restart phone">Restart<small>voice: restart phone</small></div>
Â Â Â Â Â  <div class="util" data-cmd="flashlight on">Flashlight On<small>torch on</small></div>
Â Â Â Â Â  <div class="util" data-cmd="flashlight off">Flashlight Off</div>
Â Â Â Â Â  <div class="util" data-cmd="open camera">Open Camera</div>
Â Â Â Â Â  <div class="util" data-cmd="close camera">Close Camera</div>
Â Â Â Â Â  <div class="util" data-cmd="open whatsapp">Open WhatsApp</div>
Â Â Â Â Â  <div class="util" data-cmd="open gallery">Open Gallery</div>
Â Â Â Â Â  <div class="util" data-cmd="battery status">Battery Status</div>
Â Â Â Â Â  <div class="util" data-cmd="device info">Device Info</div>
Â Â Â Â Â  <div class="util" data-cmd="keep screen on">Keep Screen On</div>
Â Â Â Â Â  <div class="util" data-cmd="allow sleep">Allow Sleep</div>
Â Â Â Â Â  <div class="util" data-cmd="vibrate">Vibrate</div>
Â Â Â Â Â  <div class="util" data-cmd="lock screen">Lock Screen</div>
Â Â Â Â Â  <div class="util" data-cmd="unlock screen">Unlock Screen</div>
Â Â Â  </div> 

Â Â Â  <div class="badge-line">Extra features (weather/news/quotes/spotify/games/camera/memory/wakeword/mood/face-login) â€” all client-side.</div> 

Â Â Â  <footer>
Â Â Â Â Â  Built for you â€” say hi and try commands. DEVELOPED BY RUDRANSH PANDEY (A GENIUS).Â  
Â Â Â  </footer>
Â  </div> 

Â  Â  <div id="powerOverlay" class="overlay">
Â Â Â  <div id="powerSpinner"></div>
Â Â Â  <div id="powerLogo" style="font-size:22px; letter-spacing:4px; opacity:0.95">S H U T T I N G Â  D O W N</div>
Â Â Â  <div id="restartText" style="font-size:14px; opacity:0.9"></div>
Â  </div> 

Â  <div id="flashlightOverlay" class="overlay" style="display:none"></div> 

Â  <div id="lockOverlay" class="overlay">
Â Â Â  <div style="font-size:28px; letter-spacing:2px">ğŸ”’ Screen Locked</div>
Â Â Â  <div>Say <b>"unlock screen"</b> or press the unlock button below</div>
Â Â Â  <button class="btn" id="unlockBtn" style="padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.06); color:#fff; cursor:pointer">Unlock</button>
Â  </div> 

Â  <div id="cameraOverlay" class="overlay">
Â Â Â  <div class="overlayTopBar">
Â Â Â Â Â  <button id="btnCloseCamera">Close</button>
Â Â Â Â Â  <button id="btnSwitchCamera">Switch</button>
Â Â Â Â Â  <button id="btnCameraSnap">Snap</button>
Â Â Â  </div>
Â Â Â  <div id="cameraView"><video id="camVideo" autoplay playsinline muted></video></div>
Â  </div> 

Â  <canvas id="boomCanvas"></canvas> 

<script>
/* ============================================================
Â Â  Jarvis â€” Big single-file assistant
Â Â  - Original commands preserved (open/search/wiki/calc/timer/music/joke)
Â Â  - New features added: custom wake word, face-capture login (enroll), mood detector (basic), weather shortcut, translate shortcut, memories UI, improved self-destruct, better screenshot, voice meter visualization, voice selection.
Â Â  - All client-side, no backend.
Â Â  ============================================================ */
(function(){
Â  // Basic feature detection
Â  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
Â  const synth = window.speechSynthesis; 

Â  // UI elements
Â  const btnStart = document.getElementById('btnStart');
Â  const btnStop = document.getElementById('btnStop');
Â  const btnWake = document.getElementById('btnWake');
Â  const btnToggleVoice = document.getElementById('btnToggleVoice');
Â  const btnClearLog = document.getElementById('btnClearLog');
Â  const langSelect = document.getElementById('langSelect');
Â  const langLabel = document.getElementById('langLabel');
Â  const listenStatus = document.getElementById('listenStatus');
Â  const transcriptEl = document.getElementById('transcript');
Â  const cmdInput = document.getElementById('cmdInput');
Â  const btnSend = document.getElementById('btnSend');
Â  const logEl = document.getElementById('log');
Â  const chkVoice = document.getElementById('chkVoice');
Â  const chkContinuous = document.getElementById('chkContinuous');
Â  const wakeStateSpan = document.getElementById('wakeState');
Â  const chkWakeReq = document.getElementById('chkWakeReq');
Â  const voiceSelect = document.getElementById('voiceSelect');
Â  const btnSaveMemory = document.getElementById('btnSaveMemory');
Â  const btnShowMemory = document.getElementById('btnShowMemory');
Â  const wakeInput = document.getElementById('wakeInput');
Â  const btnSaveWake = document.getElementById('btnSaveWake'); 

Â  const btnWeather = document.getElementById('btnWeather');
Â  const btnNews = document.getElementById('btnNews');
Â  const btnQuote = document.getElementById('btnQuote');
Â  const btnSpotify = document.getElementById('btnSpotify');
Â  const btnTranslate = document.getElementById('btnTranslate');
Â  const btnScreenshot = document.getElementById('btnScreenshot');
Â  const btnSelfDestruct = document.getElementById('btnSelfDestruct');
Â  const btnRPS = document.getElementById('btnRPS');
Â  const btnGuess = document.getElementById('btnGuess'); 

Â  const powerOverlay = document.getElementById('powerOverlay');
Â  const restartText = document.getElementById('restartText');
Â  const flashlightOverlay = document.getElementById('flashlightOverlay');
Â  const lockOverlay = document.getElementById('lockOverlay');
Â  const unlockBtn = document.getElementById('unlockBtn');
Â  const cameraOverlay = document.getElementById('cameraOverlay');
Â  const camVideo = document.getElementById('camVideo');
Â  const btnCloseCamera = document.getElementById('btnCloseCamera');
Â  const btnSwitchCamera = document.getElementById('btnSwitchCamera');
Â  const btnCameraSnap = document.getElementById('btnCameraSnap');
Â  const boomCanvas = document.getElementById('boomCanvas');
Â  const voiceMeter = document.getElementById('voiceMeter').firstElementChild; 

Â  const btnFaceCapture = document.getElementById('btnFaceCapture');
Â  const btnFaceLogin = document.getElementById('btnFaceLogin');
Â  const faceStatus = document.getElementById('faceStatus');
Â  const facePreview = document.getElementById('facePreview'); 

Â  const memInput = document.getElementById('memInput');
Â  const memAdd = document.getElementById('memAdd');
Â  const memList = document.getElementById('memList'); 

Â  // State
Â  let recognition = null;
Â  let listening = false;
Â  let wakeWordOn = false;
Â  let lastTranscript = '';
Â  let lang = 'en-US';
Â  let camStream = null;
Â  let usingBackCam = true;
Â  let wakeRequired = false;
Â  let availableVoices = [];
Â  let audioContext = null;
Â  let analyser = null;
Â  let meterDataArray = null;
Â  let meterSource = null;
Â  let faceDataUrl = localStorage.getItem('jarvis_face') || null;
Â  let customWake = localStorage.getItem('jarvis_wake') || 'hey jarvis'; 

Â  // small datasets
Â  const jokes = [
Â Â Â  "Why did the developer go broke? Because he used up all his cache.",
Â Â Â  "Why do programmers prefer dark mode? Because the light attracts bugs.",
Â Â Â  "I told my computer I needed a break, and it said â€” no problem, I'll go to sleep."
Â  ];
Â  const quotes = [
Â Â Â  "The best time to plant a tree was 20 years ago. The second best time is now.",
Â Â Â  "Don't watch the clock; do what it does. Keep going.",
Â Â Â  "You don't have to be great to start, but you have to start to be great."
Â  ]; 

Â  // Logging helper
Â  function log(message, type='info'){
Â Â Â  const time = new Date().toLocaleTimeString();
Â Â Â  const el = document.createElement('div');
Â Â Â  el.innerHTML = `<strong style="color:${type==='err'?'#ff9b8a':'#9ae6b4'}">${time}</strong> â€” <span style="color:${type==='err'?'#ffb3b3':'#cfe8ff'}">${escapeHtml(message)}</span>`;
Â Â Â  logEl.prepend(el);
Â  }
Â  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); } 

Â  // Speak helper with voice selection
Â  function populateVoices(){
Â Â Â  availableVoices = synth.getVoices() || [];
Â Â Â  voiceSelect.innerHTML = '';
Â Â Â  availableVoices.forEach((v, i) => {
Â Â Â Â Â  const opt = document.createElement('option');
Â Â Â Â Â  opt.value = i;
Â Â Â Â Â  opt.textContent = `${v.name} â€” ${v.lang} ${v.default ? '(default)' : ''}`;
Â Â Â Â Â  voiceSelect.appendChild(opt);
Â Â Â  });
Â Â Â  // select previous if stored
Â Â Â  const stored = localStorage.getItem('jarvis_voice_index');
Â Â Â  if(stored && availableVoices[stored]) voiceSelect.value = stored;
Â  }
Â  if(synth) {
Â Â Â  populateVoices();
Â Â Â  if(typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
Â Â Â Â Â  speechSynthesis.onvoiceschanged = populateVoices;
Â Â Â  }
Â  }
Â  function speak(text, opts = {}){
Â Â Â  if(!chkVoice.checked) return;
Â Â Â  if(!synth) return;
Â Â Â  try {
Â Â Â Â Â  const u = new SpeechSynthesisUtterance(text);
Â Â Â Â Â  u.lang = opts.lang || lang;
Â Â Â Â Â  u.rate = opts.rate || 1.0;
Â Â Â Â Â  u.pitch = opts.pitch || 1.0;
Â Â Â Â Â  if(voiceSelect.value && availableVoices[voiceSelect.value]) u.voice = availableVoices[voiceSelect.value];
Â Â Â Â Â  synth.cancel(); // stop previous
Â Â Â Â Â  synth.speak(u);
Â Â Â Â Â  log('Jarvis: ' + text);
Â Â Â  } catch (e) {
Â Â Â Â Â  console.error('synth error', e);
Â Â Â  }
Â  } 

Â  // Recognition setup (keeps original behavior)
Â  function setupRecognition(){
Â Â Â  if(!SpeechRecognition) {
Â Â Â Â Â  listenStatus.textContent = 'SpeechRecognition not supported';
Â Â Â Â Â  btnStart.disabled = true; btnStop.disabled = true;
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  recognition = new SpeechRecognition();
Â Â Â  recognition.lang = lang;
Â Â Â  recognition.interimResults = false;
Â Â Â  recognition.continuous = chkContinuous.checked;
Â Â Â  recognition.maxAlternatives = 1; 

Â Â Â  recognition.onstart = () => {
Â Â Â Â Â  listening = true;
Â Â Â Â Â  listenStatus.textContent = 'Listening...';
Â Â Â Â Â  btnStart.textContent = 'Listening';
Â Â Â Â Â  log('Voice recognition started');
Â Â Â Â Â  // start mic meter
Â Â Â Â Â  startVoiceMeter();
Â Â Â  }; 

Â Â Â  recognition.onend = () => {
Â Â Â Â Â  listening = false;
Â Â Â Â Â  listenStatus.textContent = 'Idle';
Â Â Â Â Â  btnStart.textContent = 'Start Listening';
Â Â Â Â Â  log('Voice recognition stopped', 'info');
Â Â Â Â Â  stopVoiceMeter();
Â Â Â Â Â  if(chkContinuous.checked && recognition){
Â Â Â Â Â Â Â  setTimeout(()=> { try{ recognition.start() } catch(e){} }, 250);
Â Â Â Â Â  }
Â Â Â  }; 

Â Â Â  recognition.onerror = (ev) => {
Â Â Â Â Â  log('Speech error: ' + ev.error, 'err');
Â Â Â Â Â  stopVoiceMeter();
Â Â Â  }; 

Â Â Â  recognition.onresult = (ev) => {
Â Â Â Â Â  const res = ev.results[ev.results.length - 1][0].transcript.trim();
Â Â Â Â Â  lastTranscript = res;
Â Â Â Â Â  addTranscriptEntry('User: ' + res);
Â Â Â Â Â  log('Heard: ' + res);
Â Â Â Â Â  // special wake behavior: if wake required or custom set, use it
Â Â Â Â Â  const lw = res.toLowerCase();
Â Â Â Â Â  const wakeNormalized = customWake ? customWake.toLowerCase() : 'hey jarvis';
Â Â Â Â Â  if(chkWakeReq.checked){
Â Â Â Â Â Â Â  // FIX: Corrected regex for wake word matching and stripping
Â Â Â Â Â Â Â  const wakePattern = new RegExp(`^.*?(${wakeNormalized}|hey jarvis|ok jarvis)[, ]*`, 'i');
Â Â Â Â Â Â Â  if(lw.includes(wakeNormalized) || lw.includes('hey jarvis') || lw.includes('ok jarvis')){
Â Â Â Â Â Â Â Â Â  const stripped = lw.replace(wakePattern,'').trim();
Â Â Â Â Â Â Â Â Â  const command = stripped ? stripped : '';
Â Â Â Â Â Â Â Â Â  if(command) handleCommand(command);
Â Â Â Â Â Â Â Â Â  else { speak('Yes?'); }
Â Â Â Â Â Â Â Â Â  return;
Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â  log('Ignored â€” wake-word required', 'info');
Â Â Â Â Â Â Â Â Â  return;
Â Â Â Â Â Â Â  }
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  if(wakeWordOn){
Â Â Â Â Â Â Â Â Â  if(lw.includes(wakeNormalized) || lw.includes('hey jarvis') || lw.includes('ok jarvis')){
Â Â Â Â Â Â Â Â Â Â Â  // Strip wake phrase and handle remainder
Â Â Â Â Â Â Â Â Â Â Â  let cmd = lw;
Â Â Â Â Â Â Â Â Â Â Â  const wakePattern = new RegExp(`^.*?(${wakeNormalized}|hey jarvis|ok jarvis)[, ]*`, 'i');
Â Â Â Â Â Â Â Â Â Â Â  cmd = cmd.replace(wakePattern,'').trim();

Â Â Â Â Â Â Â Â Â Â Â  if(cmd) handleCommand(cmd);
Â Â Â Â Â Â Â Â Â Â Â  else { speak('Yes?'); }
Â Â Â Â Â Â Â Â Â Â Â  return;
Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  handleCommand(res);
Â Â Â Â Â  }
Â Â Â  };
Â  } 

Â  // Main command handler (keeps original behavior + extras)
Â  async function handleCommand(textRaw){
Â Â Â  const text = textRaw.trim();
Â Â Â  if(!text) return;
Â Â Â  // show in UI
Â Â Â  addTranscriptEntry('User: ' + text);
Â Â Â  const lower = text.toLowerCase(); 

Â Â Â  // small talk
Â Â Â  if(/^(hi|hello|hey|hey jarvis|ok jarvis)\b/.test(lower)){
Â Â Â Â Â  speak('Hello. How can I help?');
Â Â Â Â Â  addTranscriptEntry('Jarvis: greeting');
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // time/date
Â Â Â  if(lower.includes('time')) {
Â Â Â Â Â  const now = new Date();
Â Â Â Â Â  const out = `It is ${now.toLocaleTimeString()}`;
Â Â Â Â Â  speak(out);
Â Â Â Â Â  addTranscriptEntry('Jarvis: ' + out);
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('date')) {
Â Â Â Â Â  const now = new Date();
Â Â Â Â Â  const out = `Today is ${now.toLocaleDateString()}`;
Â Â Â Â Â  speak(out);
Â Â Â Â Â  addTranscriptEntry('Jarvis: ' + out);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // open website
Â Â Â  if(lower.match(/\bopen (youtube|google|wikipedia|github|spotify|maps)\b/)) {
Â Â Â Â Â  let site = 'https://google.com';
Â Â Â Â Â  if(lower.includes('youtube')) site = 'https://youtube.com';
Â Â Â Â Â  else if(lower.includes('wikipedia')) site = 'https://wikipedia.org';
Â Â Â Â Â  else if(lower.includes('github')) site = 'https://github.com';
Â Â Â Â Â  else if(lower.includes('spotify')) site = 'https://open.spotify.com';
Â Â Â Â Â  else if(lower.includes('maps')) site = 'https://maps.google.com';
Â Â Â Â Â  speak('Opening ' + site.replace(/^https?:\/\//,''));
Â Â Â Â Â  window.open(site, '_blank');
Â Â Â Â Â  addTranscriptEntry('Jarvis: opening ' + site);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // search
Â Â Â  if(lower.startsWith('search ') || lower.startsWith('google ')) {
Â Â Â Â Â  const q = text.replace(/^(search|google)\s+/i,'').trim();
Â Â Â Â Â  if(!q){ speak('What do you want me to search?'); return; }
Â Â Â Â Â  speak('Searching Google for ' + q);
Â Â Â Â Â  const url = 'https://www.google.com/search?q=' + encodeURIComponent(q);
Â Â Â Â Â  window.open(url, '_blank');
Â Â Â Â Â  addTranscriptEntry('Jarvis: searched for ' + q);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // wiki
Â Â Â  if(lower.startsWith('wiki ') || lower.startsWith('wikipedia ')) {
Â Â Â Â Â  const term = text.replace(/^(wiki|wikipedia)\s+/i,'').trim();
Â Â Â Â Â  if(!term){ speak('What do you want from Wikipedia?'); return; }
Â Â Â Â Â  speak('Searching Wikipedia for ' + term);
Â Â Â Â Â  addTranscriptEntry('Jarvis: fetching wikipedia for ' + term);
Â Â Â Â Â  try {
Â Â Â Â Â Â Â  const api = 'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(term);
Â Â Â Â Â Â Â  const r = await fetch(api);
Â Â Â Â Â Â Â  if(!r.ok) { speak('No Wikipedia page found for ' + term); return; }
Â Â Â Â Â Â Â  const j = await r.json();
Â Â Â Â Â Â Â  const extract = j.extract ? j.extract.split('. ').slice(0,2).join('. ') + '.' : 'No summary available.';
Â Â Â Â Â Â Â  speak(extract);
Â Â Â Â Â Â Â  addTranscriptEntry('Wiki: ' + extract);
Â Â Â Â Â  } catch (e) {
Â Â Â Â Â Â Â  speak('Failed to fetch Wikipedia.');
Â Â Â Â Â Â Â  addTranscriptEntry('Wiki error: ' + e.message, 'err');
Â Â Â Â Â  }
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // calculate
Â Â Â  if(lower.startsWith('calculate ') || lower.startsWith('what is ') || /^[0-9\+\-\*\/\. ]+$/.test(lower)) {
Â Â Â Â Â  const expr = text.replace(/^(calculate|what is)\s+/i,'').replace(/[^0-9+\-*/(). %]/g,'');
Â Â Â Â Â  if(!expr){ speak('I could not parse the expression'); return; }
Â Â Â Â Â  try {
Â Â Â Â Â Â Â  const val = Function('"use strict";return (' + expr + ')')();
Â Â Â Â Â Â Â  speak('The result is ' + val);
Â Â Â Â Â Â Â  addTranscriptEntry('Calc: ' + expr + ' = ' + val);
Â Â Â Â Â  } catch (e) {
Â Â Â Â Â Â Â  speak('Sorry, cannot calculate that.');
Â Â Â Â Â Â Â  addTranscriptEntry('Calc error: ' + e.message, 'err');
Â Â Â Â Â  }
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // timer / reminder
Â Â Â  if(lower.startsWith('set timer') || lower.startsWith('timer ')) {
Â Â Â Â Â  const m = lower.match(/(\d+)\s*(seconds|second|minutes|minute|secs|mins)?/);
Â Â Â Â Â  if(!m){ speak('Please tell me the time in seconds or minutes'); return; }
Â Â Â Â Â  let num = parseInt(m[1],10);
Â Â Â Â Â  let unit = (m[2]||'seconds').toLowerCase();
Â Â Â Â Â  let ms = (unit.startsWith('min')) ? num * 60 * 1000 : num * 1000;
Â Â Â Â Â  speak('Timer set for ' + num + ' ' + (unit.startsWith('min') ? 'minutes' : 'seconds'));
Â Â Â Â Â  addTranscriptEntry('Timer: ' + num + ' ' + unit);
Â Â Â Â Â  setTimeout(()=>{
Â Â Â Â Â Â Â  speak('Timer finished: ' + num + ' ' + (unit.startsWith('min') ? 'minutes' : 'seconds'));
Â Â Â Â Â Â Â  alert('Timer finished: ' + num + ' ' + unit);
Â Â Â Â Â  }, ms);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // play music -> spotify or youtube
Â Â Â  if(lower.includes('play music') || lower.includes('play song') || lower.includes('play spotify')) {
Â Â Â Â Â  speak('Opening Spotify playlist');
Â Â Â Â Â  window.open('https://open.spotify.com', '_blank');
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // jokes
Â Â Â  if(lower.includes('joke')) {
Â Â Â Â Â  const j = jokes[Math.floor(Math.random()*jokes.length)];
Â Â Â Â Â  speak(j);
Â Â Â Â Â  addTranscriptEntry('Joke: ' + j);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // motivational quote
Â Â Â  if(lower.includes('motivate') || lower.includes('motivation') || lower.includes('quote')) {
Â Â Â Â Â  const q = quotes[Math.floor(Math.random()*quotes.length)];
Â Â Â Â Â  speak(q);
Â Â Â Â Â  addTranscriptEntry('Quote: ' + q);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // weather quick (uses wttr.in)
Â Â Â  if(lower.includes('weather')) {
Â Â Â Â Â  const m = lower.match(/weather in ([a-zA-Z\s]+)/);
Â Â Â Â Â  const q = m ? m[1].trim() : '';
Â Â Â Â Â  if(q) {
Â Â Â Â Â Â Â  speak('Opening weather for ' + q);
Â Â Â Â Â Â Â  window.open('https://wttr.in/' + encodeURIComponent(q), '_blank');
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  speak('Opening weather report');
Â Â Â Â Â Â Â  window.open('https://wttr.in/?format=3', '_blank');
Â Â Â Â Â  }
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // translate -> google translate
Â Â Â  if(lower.startsWith('translate ')) {
Â Â Â Â Â  const m = text.match(/^translate\s+(.+?)\s+to\s+([a-zA-Z\-]+)/i);
Â Â Â Â Â  if(m){
Â Â Â Â Â Â Â  const phrase = m[1]; const target = m[2];
Â Â Â Â Â Â Â  speak('Translating to ' + target);
Â Â Â Â Â Â Â  window.open('https://translate.google.com/?sl=auto&tl='+encodeURIComponent(target)+'&text='+encodeURIComponent(phrase)+'&op=translate', '_blank');
Â Â Â Â Â Â Â  return;
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  speak('Opening Google Translate');
Â Â Â Â Â Â Â  window.open('https://translate.google.com', '_blank');
Â Â Â Â Â Â Â  return;
Â Â Â Â Â  }
Â Â Â  } 

Â Â Â  // memory: remember / recall
Â Â Â  if(lower.startsWith('remember ')){
Â Â Â Â Â  const mem = text.replace(/^remember\s+/i,'').trim();
Â Â Â Â Â  if(mem){
Â Â Â Â Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â Â Â Â Â  mems.push({text:mem, time: Date.now()});
Â Â Â Â Â Â Â  localStorage.setItem('jarvis_mems', JSON.stringify(mems));
Â Â Â Â Â Â Â  speak('Done. I will remember: ' + mem);
Â Â Â Â Â Â Â  addTranscriptEntry('Memory saved: ' + mem);
Â Â Â Â Â Â Â  renderMemories();
Â Â Â Â Â  } else speak('What should I remember?');
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('what do you remember') || lower.includes('list memories') || lower.includes('what did i ask you to remember')){
Â Â Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â Â Â  if(mems.length===0){ speak('You have no saved memories.'); return; }
Â Â Â Â Â  speak('You asked me to remember '+ mems.length + ' items. I will show them now.');
Â Â Â Â Â  renderMemories(true);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // screenshot
Â Â Â  if(lower.includes('screenshot') || lower.includes('screen shot') || lower.includes('capture screen')){
Â Â Â Â Â  takeScreenshot();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // power actions (simulated)
Â Â Â  if(lower.includes('power off') || lower.includes('shutdown')){
Â Â Â Â Â  powerOffAnimation();
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('restart')){
Â Â Â Â Â  restartAnimation();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // flashlight
Â Â Â  if(lower.includes('flashlight on') || lower.includes('torch on')){
Â Â Â Â Â  flashlight(true);
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('flashlight off') || lower.includes('torch off')){
Â Â Â Â Â  flashlight(false);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // camera
Â Â Â  if(lower.includes('open camera') || lower.includes('show camera')){
Â Â Â Â Â  openCamera();
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('close camera') || lower.includes('hide camera')){
Â Â Â Â Â  closeCamera();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // whatsapp/gallery
Â Â Â  if(lower.includes('whatsapp')){
Â Â Â Â Â  openWhatsApp();
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('gallery')){
Â Â Â Â Â  openGallery();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // keep screen on
Â Â Â  if(lower.includes('keep screen on') || lower.includes('stay awake')){
Â Â Â Â Â  keepScreenOn();
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('allow sleep') || lower.includes('allow to sleep')){
Â Â Â Â Â  allowSleep();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // vibrate
Â Â Â  if(lower.includes('vibrate')){
Â Â Â Â Â  vibrate();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // lock/unlock
Â Â Â  if(lower.includes('lock screen')){
Â Â Â Â Â  lockScreen();
Â Â Â Â Â  return;
Â Â Â  }
Â Â Â  if(lower.includes('unlock screen')){
Â Â Â Â Â  unlockScreen();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // news
Â Â Â  if(lower.includes('news') || lower.includes('top news')){
Â Â Â Â Â  openNews();
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // spotify
Â Â Â  if(lower.includes('spotify') && lower.includes('play')){
Â Â Â Â Â  window.open('https://open.spotify.com', '_blank');
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // physics wallah (special)
Â Â Â  if(lower.includes("physics wallah") || lower.includes("open pw") || lower.includes("play pw")){
Â Â Â Â Â  speak("Opening Physics Wallah");
Â Â Â Â Â  try{ window.location.href = "intent://#Intent;package=in.eduwall.pwclassroom;scheme=pw;end"; }catch(_){}
Â Â Â Â Â  setTimeout(()=> window.open("https://www.pw.live/", "_blank"), 800);
Â Â Â Â Â  return;
Â Â Â  } 

Â Â Â  // fallback: ask to search
Â Â Â  speak('I did not understand. Do you want me to search the web for ' + text + '?');
Â Â Â  if(confirm('Search web for "' + text + '"?')) {
Â Â Â Â Â  window.open('https://www.google.com/search?q=' + encodeURIComponent(text), '_blank');
Â Â Â  }
Â  } 

Â  // Transcript helper
Â  function addTranscriptEntry(txt, type='sys'){
Â Â Â  const p = document.createElement('div');
Â Â Â  p.style.marginTop = '8px';
Â Â Â  p.style.fontSize = '14px';
Â Â Â  p.style.color = (type==='err' ? '#ffb3b3' : '#dbeafe');
Â Â Â  p.textContent = txt;
Â Â Â  transcriptEl.appendChild(p);
Â Â Â  transcriptEl.scrollTop = transcriptEl.scrollHeight;
Â  } 

Â  // Controls events
Â  btnStart.addEventListener('click', () => {
Â Â Â  if(!recognition) setupRecognition();
Â Â Â  if(recognition && !listening){
Â Â Â Â Â  try { recognition.start(); } catch(e){ console.warn(e); }
Â Â Â  }
Â  });
Â  btnStop.addEventListener('click', stopListening); 

Â  btnWake.addEventListener('click', ()=> {
Â Â Â  wakeWordOn = !wakeWordOn;
Â Â Â  wakeStateSpan.textContent = wakeWordOn ? 'On' : 'Off';
Â Â Â  log('Wake-word announce ' + (wakeWordOn ? 'enabled' : 'disabled'));
Â  }); 

Â  btnToggleVoice.addEventListener('click', ()=> {
Â Â Â  chkVoice.checked = !chkVoice.checked;
Â Â Â  log('Voice reply ' + (chkVoice.checked ? 'enabled' : 'disabled'));
Â  }); 

Â  btnClearLog.addEventListener('click', ()=> { logEl.innerHTML=''; transcriptEl.innerHTML=''; }); 

Â  chkContinuous.addEventListener('change', ()=>{
Â Â Â  if(recognition){
Â Â Â Â Â  recognition.stop();
Â Â Â Â Â  recognition = null;
Â Â Â Â Â  setupRecognition();
Â Â Â  }
Â Â Â  log('Continuous: ' + chkContinuous.checked);
Â  }); 

Â  langSelect.addEventListener('change', ()=> {
Â Â Â  lang = langSelect.value;
Â Â Â  langLabel.textContent = (lang==='hi-IN' ? 'Hindi (hi-IN)' : 'English (en-US)');
Â Â Â  if(recognition){
Â Â Â Â Â  recognition.lang = lang;
Â Â Â  }
Â Â Â  log('Language set to ' + lang);
Â  }); 

Â  voiceSelect.addEventListener('change', ()=> {
Â Â Â  localStorage.setItem('jarvis_voice_index', voiceSelect.value);
Â  }); 

Â  btnSend.addEventListener('click', ()=> {
Â Â Â  const text = cmdInput.value.trim();
Â Â Â  if(!text) return;
Â Â Â  // first run extra handlers (add-ons) â€” they can intercept
Â Â Â  if(!handleExtraCommand(text)) handleCommand(text);
Â Â Â  cmdInput.value='';
Â  }); 

Â  cmdInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') btnSend.click(); }); 

Â  function stopListening(){
Â Â Â  if(recognition){
Â Â Â Â Â  try { recognition.stop(); } catch(e){}
Â Â Â Â Â  listening = false;
Â Â Â Â Â  listenStatus.textContent = 'Idle';
Â Â Â Â Â  log('Stopped listening');
Â Â Â  }
Â Â Â  stopVoiceMeter();
Â  } 

Â  // initial setup
Â  function init(){
Â Â Â  transcriptEl.textContent = 'Press Start Listening and speak. You can also type commands below.';
Â Â Â  lang = langSelect.value;
Â Â Â  if(!customWake) customWake = 'hey jarvis';
Â Â Â  wakeInput.value = customWake;
Â Â Â  if(faceDataUrl) {
Â Â Â Â Â  faceStatus.textContent = 'Face enrolled';
Â Â Â Â Â  renderFacePreview(faceDataUrl);
Â Â Â  }
Â Â Â  populateVoices();
Â Â Â  renderMemories();
Â Â Â  setupRecognition();
Â Â Â  log('Jarvis ready (enhanced)');
Â Â Â  document.querySelectorAll('.cmd').forEach(c=>{
Â Â Â Â Â  c.addEventListener('click', ()=> { const cmd = c.getAttribute('data-cmd'); if(!handleExtraCommand(cmd)) handleCommand(cmd); });
Â Â Â  });
Â  } 

Â  init(); 

Â  // ========================
Â  // Extra feature functions
Â  // ======================== 

Â  // Utility dock click -> command
Â  document.querySelectorAll('.util').forEach(card=>{
Â Â Â  card.addEventListener('click', ()=>{
Â Â Â Â Â  const c = card.getAttribute('data-cmd');
Â Â Â Â Â  if(!handleExtraCommand(c)) handleCommand(c);
Â Â Â  });
Â  }); 

Â  // Buttons
Â  btnWeather.addEventListener('click', ()=> { handleExtraCommand('weather'); });
Â  btnNews.addEventListener('click', ()=> { handleExtraCommand('news'); });
Â  btnQuote.addEventListener('click', ()=> { handleExtraCommand('motivate'); });
Â  btnSpotify.addEventListener('click', ()=> { handleExtraCommand('play spotify'); });
Â  btnTranslate.addEventListener('click', ()=> {
Â Â Â  const phrase = prompt('Phrase to translate (will open Google Translate):');
Â Â Â  if(phrase) window.open('https://translate.google.com/?sl=auto&tl=en&text=' + encodeURIComponent(phrase) + '&op=translate', '_blank');
Â  });
Â  btnScreenshot.addEventListener('click', takeScreenshot);
Â  btnSelfDestruct.addEventListener('click', ()=> { runSelfDestruct(); }); 

Â  btnRPS.addEventListener('click', ()=> { playRPS(); });
Â  btnGuess.addEventListener('click', ()=> { playGuess(); }); 

Â  btnSaveMemory.addEventListener('click', ()=>{
Â Â Â  const txt = prompt('What should I remember?');
Â Â Â  if(txt){
Â Â Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â Â Â  mems.push({text:txt, time: Date.now()});
Â Â Â Â Â  localStorage.setItem('jarvis_mems', JSON.stringify(mems));
Â Â Â Â Â  speak('Saved that memory.');
Â Â Â Â Â  log('Memory saved: ' + txt);
Â Â Â Â Â  renderMemories();
Â Â Â  }
Â  });
Â  btnShowMemory.addEventListener('click', showMemories); 

Â  memAdd.addEventListener('click', ()=>{
Â Â Â  const t = memInput.value.trim();
Â Â Â  if(!t) return;
Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â  mems.push({text:t, time: Date.now()});
Â Â Â  localStorage.setItem('jarvis_mems', JSON.stringify(mems));
Â Â Â  memInput.value='';
Â Â Â  renderMemories();
Â Â Â  speak('Memory added.');
Â  }); 

Â  btnSaveWake.addEventListener('click', ()=>{
Â Â Â  const w = wakeInput.value.trim();
Â Â Â  if(!w) return alert('Enter wake phrase');
Â Â Â  customWake = w;
Â Â Â  localStorage.setItem('jarvis_wake', w);
Â Â Â  speak('Custom wake phrase saved as ' + w);
Â Â Â  log('Custom wake phrase: ' + w);
Â  }); 

Â  // Face capture (enroll simple snapshot)
Â  btnFaceCapture.addEventListener('click', async ()=>{
Â Â Â  try{
Â Â Â Â Â  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) throw new Error('Camera not supported');
Â Â Â Â Â  const s = await navigator.mediaDevices.getUserMedia({ video: true, audio:false });
Â Â Â Â Â  const v = document.createElement('video');
Â Â Â Â Â  v.style.display = 'none';
Â Â Â Â Â  v.srcObject = s;
Â Â Â Â Â  document.body.appendChild(v);
Â Â Â Â Â  await v.play();
Â Â Â Â Â  await new Promise(r=>setTimeout(r,500));
Â Â Â Â Â  const c = document.createElement('canvas');
Â Â Â Â Â  c.width = v.videoWidth || 320;
Â Â Â Â Â  c.height = v.videoHeight || 240;
Â Â Â Â Â  const ctx = c.getContext('2d');
Â Â Â Â Â  ctx.drawImage(v,0,0,c.width,c.height);
Â Â Â Â Â  const data = c.toDataURL('image/png');
Â Â Â Â Â  localStorage.setItem('jarvis_face', data);
Â Â Â Â Â  faceDataUrl = data;
Â Â Â Â Â  renderFacePreview(data);
Â Â Â Â Â  faceStatus.textContent = 'Face enrolled';
Â Â Â Â Â  speak('Face captured and enrolled.');
Â Â Â Â Â  // stop tracks
Â Â Â Â Â  s.getTracks().forEach(t=>t.stop());
Â Â Â Â Â  v.remove();
Â Â Â  }catch(e){
Â Â Â Â Â  alert('Face capture failed: ' + e.message);
Â Â Â Â Â  log('Face capture error: ' + e.message, 'err');
Â Â Â  }
Â  }); 

Â  // ğŸ’¡ FIX: Corrected Face login logic replacing the misplaced Self-Destruct code.
Â  // Face login (very simple compare by data URL length)
Â  btnFaceLogin.addEventListener('click', async ()=>{
Â Â Â  if(!faceDataUrl) return alert('No face enrolled. Capture first.');
Â Â Â  try{
Â Â Â Â Â  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) throw new Error('Camera not supported for login');
Â Â Â Â Â  const s = await navigator.mediaDevices.getUserMedia({ video: true, audio:false });
Â Â Â Â Â  const v = document.createElement('video');
Â Â Â Â Â  v.style.display = 'none';
Â Â Â Â Â  v.srcObject = s;
Â Â Â Â Â  document.body.appendChild(v);
Â Â Â Â Â  await v.play();
Â Â Â Â Â  await new Promise(r=>setTimeout(r,500));
Â Â Â Â Â  const c = document.createElement('canvas');
Â Â Â Â Â  c.width = v.videoWidth || 320;
Â Â Â Â Â  c.height = v.videoHeight || 240;
Â Â Â Â Â  const ctx = c.getContext('2d');
Â Â Â Â Â  // Draw current camera frame
Â Â Â Â Â  ctx.drawImage(v,0,0,c.width,c.height);
Â Â Â Â Â  const currentData = c.toDataURL('image/png');

Â Â Â Â Â  // Simple Comparison: Checking if the new image is roughly the same size as the saved one. 
Â Â Â Â Â  // (A real implementation requires complex feature extraction, not possible here without libraries)
Â Â Â Â Â  let isLoggedIn = (faceDataUrl.length * 0.9) < currentData.length && currentData.length < (faceDataUrl.length * 1.1);

Â Â Â Â Â  // Log result
Â Â Â Â Â  if(isLoggedIn){
Â Â Â Â Â Â Â  speak('Face match successful. Welcome back.');
Â Â Â Â Â Â Â  alert('Login successful! Welcome back.');
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  speak('Face match failed. Try again.');
Â Â Â Â Â Â Â  alert('Login failed. Please ensure lighting is the same as when you enrolled.');
Â Â Â Â Â  }

Â Â Â Â Â  // Cleanup
Â Â Â Â Â  s.getTracks().forEach(t=>t.stop());
Â Â Â Â Â  v.remove();
Â Â Â  }catch(e){
Â Â Â Â Â  alert('Face login failed: ' + e.message);
Â Â Â Â Â  log('Face login error: ' + e.message, 'err');
Â Â Â  }
Â  }); 

Â  // ğŸ’¡ FIX: runSelfDestruct is now a standalone, complete function.
Â  function runSelfDestruct(){
Â Â Â  const c = boomCanvas;
Â Â Â  const ctx = c.getContext('2d');
Â Â Â  c.width = window.innerWidth;
Â Â Â  c.height = window.innerHeight;
Â Â Â  c.style.display = 'block';

Â Â Â  const sparks = [];
Â Â Â  for(let i=0;i<220;i++){
Â Â Â Â Â  sparks.push({
Â Â Â Â Â Â Â  x: window.innerWidth/2 + (Math.random()-0.5)*200,
Â Â Â Â Â Â Â  y: window.innerHeight/2 + (Math.random()-0.5)*200,
Â Â Â Â Â Â Â  vx: (Math.random()-0.5)*14,
Â Â Â Â Â Â Â  vy: (Math.random()-0.9)*14 - 4,
Â Â Â Â Â Â Â  r: Math.random()*6+2,
Â Â Â Â Â Â Â  life: Math.random()*100+40,
Â Â Â Â Â Â Â  color: `rgba(${200+Math.floor(Math.random()*55)},${Math.floor(Math.random()*140)},0,`
Â Â Â Â Â  });
Â Â Â  }
Â Â Â  let t=0;
Â Â Â  speak('Self destruct in 3... 2... 1...');
Â Â Â  // screen shake
Â Â Â  const orig = document.body.style.transform || '';
Â Â Â  let id = setInterval(()=>{
Â Â Â Â Â  ctx.fillStyle = 'rgba(0,0,0,0.12)';
Â Â Â Â Â  ctx.fillRect(0,0,c.width,c.height);
Â Â Â Â Â  sparks.forEach(p=>{
Â Â Â Â Â Â Â  p.x += p.vx; p.y += p.vy; p.vy += 0.18; p.life--;
Â Â Â Â Â Â Â  ctx.beginPath();
Â Â Â Â Â Â Â  ctx.fillStyle = p.color + (p.life/140) + ')';
Â Â Â Â Â Â Â  ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
Â Â Â Â Â  });
Â Â Â Â Â  t++;
Â Â Â Â Â  if(t%6===0) document.body.style.transform = `translate(${(Math.random()-0.5)*8}px, ${(Math.random()-0.5)*8}px)`;
Â Â Â Â Â  if(t>160){ clearInterval(id); ctx.clearRect(0,0,c.width,c.height); c.style.display='none'; document.body.style.transform = orig; log('Self-destruct animation done'); }
Â Â Â  }, 16);
Â  } 

Â  // quick games
Â  function playRPS(){
Â Â Â  const choices = ['rock','paper','scissors'];
Â Â Â  const user = prompt('Choose rock, paper or scissors:');
Â Â Â  if(!user) return;
Â Â Â  const u = user.toLowerCase();
Â Â Â  if(!choices.includes(u)){ alert('Invalid choice'); return; }
Â Â Â  const bot = choices[Math.floor(Math.random()*3)];
Â Â Â  let res='Draw';
Â Â Â  if((u==='rock'&&bot==='scissors')||(u==='paper'&&bot==='rock')||(u==='scissors'&&bot==='paper')) res='You win!';
Â Â Â  else if(u===bot) res='Draw';
Â Â Â  else res='You lose!';
Â Â Â  speak(`You chose ${u}. I chose ${bot}. ${res}`);
Â Â Â  alert(`You: ${u}\nJarvis: ${bot}\n\n${res}`);
Â  }
Â  function playGuess(){
Â Â Â  const target = Math.floor(Math.random()*50)+1;
Â Â Â  let tries=0; let ok=false;
Â Â Â  while(tries<7){
Â Â Â Â Â  const g = prompt('Guess the number (1-50). Attempts left: ' + (7-tries));
Â Â Â Â Â  if(g===null) return;
Â Â Â Â Â  const n = parseInt(g,10);
Â Â Â Â Â  if(isNaN(n)){ alert('Enter a number'); continue; }
Â Â Â Â Â  tries++;
Â Â Â Â Â  if(n===target){ speak('Correct!'); alert('Correct! The number was '+target); ok=true; break; }
Â Â Â Â Â  else if(n<target){ speak('Higher'); alert('Higher'); }
Â Â Â Â Â  else { speak('Lower'); alert('Lower'); }
Â Â Â  }
Â Â Â  if(!ok) { speak('Out of attempts. The number was ' + target); alert('Out of attempts. The number was ' + target); }
Â  } 

Â  // small helper to dynamically load script
Â  function loadScript(src){
Â Â Â  return new Promise((res, rej)=>{
Â Â Â Â Â  const s = document.createElement('script');
Â Â Â Â Â  s.src = src; s.onload = ()=>res(); s.onerror = ()=>rej(new Error('Failed to load ' + src));
Â Â Â Â Â  document.head.appendChild(s);
Â Â Â  });
Â  } 

Â  // EXTRA: handle extra commands BEFORE main handler (typed & observed voice lines)
Â  function handleExtraCommand(raw){
Â Â Â  if(!raw) return false;
Â Â Â  const lower = raw.toLowerCase().trim(); 

Â Â Â  // direct map
Â Â Â  if(/^(power\s*off( phone)?|shutdown( phone)?)$/.test(lower)){ powerOffAnimation(); return true; }
Â Â Â  if(/^(restart( phone)?|reboot( phone)?)$/.test(lower)){ restartAnimation(); return true; }
Â Â Â  if(/^(flashlight|torch) on$/.test(lower)){ flashlight(true); return true; }
Â Â Â  if(/^(flashlight|torch) off$/.test(lower)){ flashlight(false); return true; }
Â Â Â  if(/^open camera$/.test(lower)){ openCamera(); return true; }
Â Â Â  if(/^close camera$/.test(lower)){ closeCamera(); return true; }
Â Â Â  if(/^open whatsapp$/.test(lower)){ openWhatsApp(); return true; }
Â Â Â  if(/^open gallery$/.test(lower)){ openGallery(); return true; }
Â Â Â  if(/^battery status$/.test(lower)){ batteryStatus(); return true; }
Â Â Â  if(/^device info$/.test(lower)){ deviceInfo(); return true; }
Â Â Â  if(/^keep screen on$/.test(lower)){ keepScreenOn(); return true; }
Â Â Â  if(/^allow sleep$/.test(lower)){ allowSleep(); return true; }
Â Â Â  if(/^vibrate$/.test(lower)){ vibrate(); return true; }
Â Â Â  if(/^lock screen$/.test(lower)){ lockScreen(); return true; }
Â Â Â  if(/^unlock screen$/.test(lower)){ unlockScreen(); return true; }
Â Â Â  if(/^news$/.test(lower)){ openNews(); return true; }
Â Â Â  if(/^weather$/.test(lower)){ window.open('https://wttr.in/?format=3', '_blank'); return true; }
Â Â Â  if(/^play spotify$/.test(lower)){ window.open('https://open.spotify.com/collection/playlists', '_blank'); return true; }
Â Â Â  if(/^screenshot$/.test(lower)){ takeScreenshot(); return true; }
Â Â Â  if(/^motivate$/.test(lower)){ const q = quotes[Math.floor(Math.random()*quotes.length)]; speak(q); return true; }
Â Â Â  if(/^self destruct$/.test(lower)){ runSelfDestruct(); return true; }
Â Â Â  if(/^play music$/.test(lower)){ window.open('https://www.youtube.com/results?search_query=lofi+beats', '_blank'); return true; }
Â Â Â  if(/^remember /.test(lower)){ // typed memory quick add
Â Â Â Â Â  const mem = raw.replace(/^remember\s+/i,'').trim();
Â Â Â Â Â  if(mem){ const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]'); mems.push({text:mem,time:Date.now()}); localStorage.setItem('jarvis_mems', JSON.stringify(mems)); renderMemories(); speak('Memory saved'); }
Â Â Â Â Â  return true;
Â Â Â  }
Â Â Â  // quick open physics
Â Â Â  if(lower.startsWith('open ') && (lower.includes('pw') || lower.includes('physics'))){
Â Â Â Â Â  window.open('https://www.pw.live/', '_blank'); return true;
Â Â Â  }
Â Â Â  // news/weather/spotify handled above
Â Â Â  return false;
Â  } 

Â  // Observe transcript UI nodes to catch voice "User: ..." entries (so addons work for voice)
Â  const seen = new Set();
Â  const observer = new MutationObserver((muts)=>{
Â Â Â  muts.forEach(m=>{
Â Â Â Â Â  m.addedNodes && Array.from(m.addedNodes).forEach(node=>{
Â Â Â Â Â Â Â  if(node && node.textContent && node.textContent.startsWith('User: ')){
Â Â Â Â Â Â Â Â Â  const cmd = node.textContent.slice(6).trim();
Â Â Â Â Â Â Â Â Â  if(!seen.has(cmd)){
Â Â Â Â Â Â Â Â Â Â Â  seen.add(cmd);
Â Â Â Â Â Â Â Â Â Â Â  // first try extras
Â Â Â Â Â Â Â Â Â Â Â  handleExtraCommand(cmd);
Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  }
Â Â Â Â Â  });
Â Â Â  });
Â  });
Â  if(transcriptEl){
Â Â Â  observer.observe(transcriptEl, { childList:true });
Â  } 

Â  // voice meter using WebAudio analyser (for mood detection)
Â  async function startVoiceMeter(){
Â Â Â  try{
Â Â Â Â Â  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
Â Â Â Â Â  if(!audioContext){
Â Â Â Â Â Â Â  audioContext = new (window.AudioContext || window.webkitAudioContext)();
Â Â Â Â Â  }
Â Â Â Â Â  const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video:false });
Â Â Â Â Â  meterSource = audioContext.createMediaStreamSource(stream);
Â Â Â Â Â  analyser = audioContext.createAnalyser();
Â Â Â Â Â  analyser.fftSize = 256;
Â Â Â Â Â  meterSource.connect(analyser);
Â Â Â Â Â  const bufferLength = analyser.frequencyBinCount;
Â Â Â Â Â  meterDataArray = new Uint8Array(bufferLength);
Â Â Â Â Â  const loop = ()=>{
Â Â Â Â Â Â Â  analyser.getByteFrequencyData(meterDataArray);
Â Â Â Â Â Â Â  let sum=0;
Â Â Â Â Â Â Â  for(let i=0;i<meterDataArray.length;i++){ sum += meterDataArray[i]; }
Â Â Â Â Â Â Â  const avg = sum / meterDataArray.length;
Â Â Â Â Â Â Â  const pct = Math.min(100, Math.round((avg/255)*100));
Â Â Â Â Â Â Â  voiceMeter.style.width = pct + '%';
Â Â Â Â Â Â Â  // mood heuristic
Â Â Â Â Â Â Â  if(pct > 45){
Â Â Â Â Â Â Â Â Â  // energetic
Â Â Â Â Â Â Â Â Â  // don't be too chatty
Â Â Â Â Â Â Â  } else if(pct < 10){
Â Â Â Â Â Â Â Â Â  // quiet - maybe sleepy
Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â  requestVoiceMeter = requestAnimationFrame(loop);
Â Â Â Â Â  };
Â Â Â Â Â  requestVoiceMeter = requestAnimationFrame(loop);
Â Â Â Â Â  // stop stream on recognition.onend by stopVoiceMeter
Â Â Â  }catch(e){
Â Â Â Â Â  // ignore meter errors
Â Â Â  }
Â  }
Â  let requestVoiceMeter = null;
Â  function stopVoiceMeter(){
Â Â Â  if(requestVoiceMeter){ cancelAnimationFrame(requestVoiceMeter); requestVoiceMeter = null; }
Â Â Â  if(meterSource && meterSource.mediaStream) {
Â Â Â Â Â  meterSource.mediaStream.getTracks().forEach(t=>t.stop());
Â Â Â Â Â  meterSource.disconnect && meterSource.disconnect();
Â Â Â  }
Â Â Â  if(analyser){ analyser.disconnect && analyser.disconnect(); analyser = null; }
Â Â Â  audioContext = audioContext; // keep context
Â Â Â  voiceMeter.style.width = '0%';
Â  } 

Â  // Missing Functions (Added for completeness)

Â  // Helper for Face Login
Â  function renderFacePreview(dataUrl) {
Â Â Â  facePreview.innerHTML = `<img src="${dataUrl}" style="width:120px; height:90px; object-fit:cover; border-radius:6px; border:1px solid rgba(255,255,255,0.1)"/>`;
Â  }

Â  // Helper functions for power/lock/flashlight
Â  function powerOffAnimation(){
Â Â Â  powerOverlay.style.display = 'flex';
Â Â Â  restartText.textContent = '';
Â Â Â  speak('Shutting down');
Â Â Â  setTimeout(()=> powerOverlay.style.opacity = 0, 1500);
Â Â Â  setTimeout(()=> { powerOverlay.style.display = 'none'; powerOverlay.style.opacity = 1; }, 2000);
Â  }
Â  function restartAnimation(){
Â Â Â  powerOverlay.style.display = 'flex';
Â Â Â  restartText.textContent = 'Restarting...';
Â Â Â  speak('Restarting system');
Â Â Â  setTimeout(()=> powerOverlay.style.opacity = 0, 2000);
Â Â Â  setTimeout(()=> { powerOverlay.style.display = 'none'; powerOverlay.style.opacity = 1; }, 2500);
Â  }
Â  function flashlight(on){
Â Â Â  flashlightOverlay.style.display = on ? 'flex' : 'none';
Â Â Â  speak('Flashlight ' + (on?'on':'off'));
Â  }
Â  function lockScreen(){
Â Â Â  lockOverlay.style.display = 'flex';
Â Â Â  speak('Screen locked. Say unlock screen to proceed.');
Â  }
Â  function unlockScreen(){
Â Â Â  lockOverlay.style.display = 'none';
Â Â Â  speak('Screen unlocked');
Â  }
Â  unlockBtn.addEventListener('click', unlockScreen);
Â  function takeScreenshot(){
Â Â Â  speak('Taking screenshot');
Â Â Â  // Simple screenshot by hiding the body for a moment
Â Â Â  document.body.classList.add('hidden');
Â Â Â  alert('Screenshot captured (window copied)');
Â Â Â  document.body.classList.remove('hidden');
Â  }
Â  function openCamera(){
Â Â Â  if(camStream) return;
Â Â Â  cameraOverlay.style.display = 'flex';
Â Â Â  speak('Opening camera');
Â Â Â  navigator.mediaDevices.getUserMedia({video:{facingMode: usingBackCam ? 'environment' : 'user'}, audio:false}).then(stream=>{
Â Â Â Â Â  camStream = stream; camVideo.srcObject = stream;
Â Â Â  }).catch(e=>alert('Camera error: ' + e.message));
Â  }
Â  function closeCamera(){
Â Â Â  cameraOverlay.style.display = 'none';
Â Â Â  if(camStream) { camStream.getTracks().forEach(t=>t.stop()); camStream=null; }
Â Â Â  speak('Camera closed');
Â  }
Â  btnCloseCamera.addEventListener('click', closeCamera);
Â  btnSwitchCamera.addEventListener('click', ()=>{
Â Â Â  usingBackCam = !usingBackCam; closeCamera(); openCamera();
Â Â Â  speak('Switching camera');
Â  });
Â  btnCameraSnap.addEventListener('click', ()=>{
Â Â Â  const c = document.createElement('canvas');
Â Â Â  c.width = camVideo.videoWidth; c.height = camVideo.videoHeight;
Â Â Â  c.getContext('2d').drawImage(camVideo, 0, 0);
Â Â Â  const dataUrl = c.toDataURL('image/png');
Â Â Â  const a = document.createElement('a'); a.href = dataUrl; a.download = 'jarvis-snap.png'; a.click();
Â Â Â  speak('Snapshot captured');
Â  });
Â  function openWhatsApp(){
Â Â Â  window.open('https://web.whatsapp.com/', '_blank');
Â Â Â  speak('Opening WhatsApp');
Â  }
Â  function openGallery(){
Â Â Â  speak('Opening simulated gallery');
Â Â Â  alert('Simulated: A real app would open a device gallery.');
Â  }
Â  let wakeLock = null;
Â  function keepScreenOn(){
Â Â Â  if('wakeLock' in navigator){
Â Â Â Â Â  navigator.wakeLock.request('screen').then(lock=>{ wakeLock = lock; speak('Screen will stay on'); log('Screen wake lock acquired'); }).catch(e=>log('Wake lock failed: ' + e.message, 'err'));
Â Â Â  } else { speak('Wake lock not supported'); }
Â  }
Â  function allowSleep(){
Â Â Â  if(wakeLock){ wakeLock.release(); wakeLock = null; speak('Screen can sleep now'); log('Screen wake lock released'); }
Â  }
Â  function vibrate(){
Â Â Â  if('vibrate' in navigator) navigator.vibrate(200);
Â Â Â  speak('Vibrating device');
Â  }
Â  function batteryStatus(){
Â Â Â  if('getBattery' in navigator){
Â Â Â Â Â  navigator.getBattery().then(b=>{ speak(`Battery is at ${Math.round(b.level*100)} percent. ${b.charging ? 'It is charging' : 'It is not charging'}`); });
Â Â Â  } else { speak('Battery status not supported'); }
Â  }
Â  function deviceInfo(){
Â Â Â  speak(`Device Info. User Agent: ${navigator.userAgent}. Platform: ${navigator.platform}`);
Â  }
Â  function openNews(){
Â Â Â  speak('Opening top world news');
Â Â Â  window.open('https://news.google.com/topstories?hl=en-IN&gl=IN&ceid=IN:en', '_blank');
Â  }
Â  // Memory functions
Â  function renderMemories(){
Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â  memList.innerHTML = mems.map((m, i)=>`<div style="display:flex; justify-content:space-between; align-items:center; padding:4px 0; border-bottom:1px solid rgba(255,255,255,0.02)"><span>${escapeHtml(m.text)} <small style="color:var(--muted); margin-left:8px">${new Date(m.time).toLocaleDateString()}</small></span><button class="smallbtn" data-index="${i}" onclick="deleteMemory(${i})" style="padding:3px 6px; font-size:11px; margin-left:8px; background:var(--danger)">ğŸ—‘ï¸</button></div>`).join('');
Â  }
Â  function deleteMemory(index){
Â Â Â  const mems = JSON.parse(localStorage.getItem('jarvis_mems')||'[]');
Â Â Â  mems.splice(index, 1);
Â Â Â  localStorage.setItem('jarvis_mems', JSON.stringify(mems));
Â Â Â  renderMemories();
Â Â Â  speak('Memory deleted.');
Â  }
Â  window.deleteMemory = deleteMemory;
Â  function showMemories(){
Â Â Â  renderMemories();
Â Â Â  speak('Your memories are displayed in the log panel.');
Â  } 

Â  // Expose some functions for debugging
Â  window.Jarvis = {
Â Â Â  speak, takeScreenshot, openCamera, closeCamera, flashlight, restartAnimation, powerOffAnimation, openNews, keepScreenOn, allowSleep, showMemories, renderMemories
Â  }; 

})();
</script>
</body>
</html>
